<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TOMZ FOOD & DRINK</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root { --accent:#ee4d2d; --wa:#25D366; }
body{margin:0;background:#090909;font-family:Arial;color:#222}
.hidden{display:none!important}

.box-area{background:#000;width:360px;margin:40px auto;padding:20px;border-radius:12px;color:#fff}
.input-group input{background:#333;border:none;color:#fff}
.btn-login,.btn-register{background:gold;border:none;width:100%;padding:10px;border-radius:6px;font-weight:bold;margin-top:10px}

header{background:#fff}
.hero{height:50vh;background:#222;display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff;text-align:center}
.hero .btn{background:#ffc107;padding:10px 25px;border-radius:25px;font-weight:bold}

.menu-section{background:#fff;padding:30px 15px;text-align:center}
.menu-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;max-width:1000px;margin:auto}
.menu-item{background:#fafafa;padding:12px;border-radius:12px;box-shadow:0 3px 8px rgba(0,0,0,.1)}
.menu-item img{width:100%;height:160px;object-fit:cover;border-radius:10px}
.btn-beli{background:var(--wa);color:#fff;border:none;padding:10px;width:100%;border-radius:8px;font-weight:bold}

.wa-float{position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:50%;background:var(--wa);display:flex;align-items:center;justify-content:center;cursor:pointer}
.wa-float img{width:34px}

.small-muted{font-size:13px;color:#666}
</style>
</head>
<body>

<!-- LOGIN -->
<section id="loginSection">
  <div class="box-area">
    <h3 class="text-center">Login</h3>
    <input id="loginUsername" class="form-control mb-2" placeholder="Nama">
    <input id="loginPassword" type="password" class="form-control" placeholder="Password">
    <button class="btn-login" onclick="login()">Login</button>
    <div class="text-center mt-2">
      Belum punya akun?
      <span style="color:gold;cursor:pointer" onclick="showRegister()">Daftar</span>
    </div>
  </div>
</section>

<!-- REGISTER -->
<section id="registerSection" class="hidden">
  <div class="box-area">
    <h3 class="text-center">Register</h3>
    <input id="registerUsername" class="form-control mb-2" placeholder="Nama">
    <input id="registerPassword" type="password" class="form-control" placeholder="Password">
    <button class="btn-register" onclick="register()">Simpan</button>
    <div class="text-center mt-2">
      Sudah punya akun?
      <span style="color:gold;cursor:pointer" onclick="showLogin()">Login</span>
    </div>
  </div>
</section>

<!-- BERANDA -->
<section id="berandaSection" class="hidden">
  <header class="p-3 bg-dark text-white d-flex justify-content-between">
    <span>TOMZ FOOD</span>
    <button class="btn btn-warning" onclick="logout()">Logout</button>
  </header>

  <div class="hero">
    <h1>Selamat Datang</h1>
    <p>Makanan enak setiap hari</p>
    <button class="btn" onclick="goMenu()">Lihat Menu</button>
  </div>
</section>
<!-- Informasi Pengantaran - Beranda -->
<div style="
  margin-top:15px; 
  padding:15px; 
  background:#ffffff; 
  border:2px solid #ff9800; 
  border-radius:12px; 
  text-align:center; 
  box-shadow:0 3px 8px rgba(0,0,0,0.15);
">
  <h4 style="margin:0 0 8px 0; font-size:17px; font-weight:bold; color:#e65100;">
    Informasi Pengantaran
  </h4>
  <div class="delivery-info" style="text-align:center; margin-top:20px; font-size:1.2rem; font-weight:600;">
  Pengantaran: Senin–Jum'at 17:15–20:00 • Sabtu–Minggu 07:00–20:00
</div>


<!-- MENU -->
<section id="menuSection" class="hidden">
  <div class="menu-section">
    <h2>Menu</h2>
    <input id="searchInput" class="form-control mb-3" placeholder="Cari menu..." oninput="renderMenu()">

    <div id="menuContainer" class="menu-container"></div>

    <div class="mt-3 d-flex gap-2 justify-content-center">
      <button class="btn btn-primary" onclick="goAddMenu()">Tambah Menu</button>
      <button class="btn btn-secondary" onclick="goBeranda()">Kembali</button>
      <button class="btn btn-warning" onclick="goCart()">Lihat Keranjang</button>
    </div>
  </div>
</section>

<!-- KERANJANG -->
<section id="cartSection" class="hidden">
  <div class="menu-section">
    <h2>Keranjang</h2>
    <div id="cartContainer"></div>
    <div class="mt-3 d-flex gap-2 justify-content-center">
      <button class="btn btn-success" onclick="checkout()">Checkout</button>
      <button class="btn btn-secondary" onclick="goMenu()">Kembali ke Menu</button>
    </div>
  </div>
</section>

<!-- ADD MENU -->
<section id="addMenuSection" class="hidden">
  <div class="menu-section">
    <h2>Tambah Menu</h2>
    <input id="newMenuName" class="form-control mb-2" placeholder="Nama menu">
    <input id="newMenuPrice" type="number" class="form-control mb-2" placeholder="Harga">
    <input id="newMenuImage" class="form-control mb-3" placeholder="URL gambar">
    <button class="btn btn-success w-100" onclick="saveMenu()">Simpan Menu</button>
    <button class="btn btn-secondary w-100 mt-2" onclick="goMenu()">Kembali</button>
  </div>
</section>

<!-- WA FLOAT -->
<div class="wa-float" onclick="window.open('https://wa.me/62895343287264')">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA">
</div>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* =========================
   Konfigurasi & data awal
   ========================= */
const firebaseConfig = {
  apiKey: "AIzaSyBKMRuTSssM4G3ui7OKamS79hHsPykDRP0",
  authDomain: "food-bb82e.firebaseapp.com",
  databaseURL: "https://food-bb82e-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "food-bb82e",
  storageBucket: "food-bb82e.firebasestorage.app",
  messagingSenderId: "95052698382",
  appId: "1:95052698382:web:2d7c6f020f27133c527d5f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let allMenus = [];
const defaultMenus = [
  { nama: 'Martabak Mini', harga: 3000, gambar: 'https://vui.unsplash.com/resize?height=256&quality=60&type=auto&url=https%3A%2F%2Fsearched-images.s3.us-west-2.amazonaws.com%2F97df095d-cddd-4efc-ace5-8d697a565384%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Credential%3DAKIAQ4GRIA4QQ7L7GEOH%252F20251211%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20251211T013230Z%26X-Amz-Expires%3D86400%26X-Amz-SignedHeaders%3Dhost%26X-Amz-Signature%3D2aa276dcb80e6df319f31d837bde6443bdbdefc0eb89b77081e681152f296ca3&sign=UROdS0Nii5cWt0hHEqvZ7w4pO9uK8KXUnWjctbsRFpo' },
  { nama: 'Pisang Coklat', harga: 3000, gambar: 'https://vui.unsplash.com/resize?height=256&quality=60&type=auto&url=https%3A%2F%2Fsearched-images.s3.us-west-2.amazonaws.com%2F2d85c862-263e-4a11-a310-40be4cf8eff2%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Credential%3DAKIAQ4GRIA4QQ7L7GEOH%252F20251211%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20251211T013345Z%26X-Amz-Expires%3D86400%26X-Amz-SignedHeaders%3Dhost%26X-Amz-Signature%3D1f82501308f7cb2e177dd48c467e30345b2112f4cc7211d559f7a6557d98d5f7&sign=ua3VXfttWVX7xdtbsZSyFZz2gYvJNQkOuRZP6lN2bx4' }
];

/* =========================
   DOM references
   ========================= */
const sections = document.querySelectorAll('section');
const loginSection = document.getElementById('loginSection');
const registerSection = document.getElementById('registerSection');
const berandaSection = document.getElementById('berandaSection');
const menuSection = document.getElementById('menuSection');
const cartSection = document.getElementById('cartSection');
const addMenuSection = document.getElementById('addMenuSection');

const menuContainer = document.getElementById('menuContainer');
const cartContainer = document.getElementById('cartContainer');
const searchInput = document.getElementById('searchInput');

/* =========================
   State
   ========================= */
let cart = []; // menyimpan {nama, harga}

/* =========================
   Utility: hideAll yang aman
   ========================= */
function hideAll(){
  // Sembunyikan semua section agar tidak ada bagian yang 'nyangkut'
  sections.forEach(s => s.classList.add('hidden'));
}

/* =========================
   Navigation helpers
   ========================= */
function showLogin(){ hideAll(); loginSection.classList.remove('hidden'); }
function showRegister(){ hideAll(); registerSection.classList.remove('hidden'); }
function goBeranda(){ hideAll(); berandaSection.classList.remove('hidden'); }
function goMenu(){ hideAll(); menuSection.classList.remove('hidden'); renderMenu(); }
function goCart(){ hideAll(); cartSection.classList.remove('hidden'); renderCart(); }
function goAddMenu(){ hideAll(); addMenuSection.classList.remove('hidden'); }

/* =========================
   Auth (localStorage simple)
   ========================= */
function register(){
  const u = document.getElementById('registerUsername').value.trim();
  const p = document.getElementById('registerPassword').value;
  if(!u || !p){ alert('Isi nama & password'); return; }
  localStorage.setItem('user', JSON.stringify({u,p}));
  alert('Akun dibuat');
  document.getElementById('registerUsername').value = '';
  document.getElementById('registerPassword').value = '';
  showLogin();
}

function login(){
  const creds = JSON.parse(localStorage.getItem('user') || '{}');
  if(document.getElementById('loginUsername').value === creds.u && document.getElementById('loginPassword').value === creds.p){
    localStorage.setItem('login', '1');
    goBeranda();
  } else {
    alert('Login gagal');
  }
}

function logout(){
  localStorage.removeItem('login');
  showLogin();
}

/* =========================
   Firebase listener (menus)
   ========================= */
db.ref("menus").on("value", snapshot => {
  const data = snapshot.val() || {};
  const firebaseMenus = Object.keys(data).map(key => ({ id: key, ...data[key] }));
  allMenus = [...defaultMenus, ...firebaseMenus];
  // Jika saat ini sedang di menu, re-render agar perubahan realtime terlihat
  if(!menuSection.classList.contains('hidden')) renderMenu();
});

/* =========================
   Render menu (HANYA menu)
   ========================= */
function renderMenu(){
  menuContainer.innerHTML = '';
  const keyword = (searchInput.value || '').toLowerCase();

  const filtered = allMenus.filter(m => (m.nama || '').toLowerCase().includes(keyword));
  if(filtered.length === 0){
    menuContainer.innerHTML = '<p class="small-muted">Menu tidak ditemukan</p>';
    return;
  }

  filtered.forEach(m => {
    // Buat elemen menu dengan DOM API (aman untuk nama / karakter special)
    const wrap = document.createElement('div');
    wrap.className = 'menu-item';

    const img = document.createElement('img');
    img.src = m.gambar || 'https://via.placeholder.com/400x300?text=No+Image';
    img.alt = m.nama || 'menu';

    const h5 = document.createElement('h5');
    h5.textContent = m.nama;

    const p = document.createElement('p');
    p.textContent = `Rp${Number(m.harga).toLocaleString('id-ID')}`;

    const btnOrder = document.createElement('button');
    btnOrder.className = 'btn-beli';
    btnOrder.type = 'button';
    btnOrder.textContent = 'ORDER';
    // gunakan closure untuk aman
    btnOrder.addEventListener('click', () => {
      order(m.nama, Number(m.harga));
    });

    wrap.appendChild(img);
    wrap.appendChild(h5);
    wrap.appendChild(p);
    wrap.appendChild(btnOrder);

    // Jika menu berasal dari firebase (punya id) tambahkan tombol HAPUS
    if(m.id){
      const btnHapus = document.createElement('button');
      btnHapus.className = 'btn btn-danger mt-2 w-100';
      btnHapus.type = 'button';
      btnHapus.textContent = 'HAPUS';
      btnHapus.addEventListener('click', () => {
        if(confirm('Hapus menu ini?')) db.ref('menus/' + m.id).remove();
      });
      wrap.appendChild(btnHapus);
    }

    menuContainer.appendChild(wrap);
  });
}

/* =========================
   Menambah menu ke Firebase
   ========================= */
function saveMenu(){
  const nama = (document.getElementById('newMenuName').value || '').trim();
  const harga = Number(document.getElementById('newMenuPrice').value || 0);
  const gambar = document.getElementById('newMenuImage').value || 'https://via.placeholder.com/400x300?text=No+Image';

  if(!nama || !harga){ alert('Isi nama dan harga'); return; }

  db.ref('menus').push({ nama, harga, gambar })
    .then(() => {
      // kosongkan input
      document.getElementById('newMenuName').value = '';
      document.getElementById('newMenuPrice').value = '';
      document.getElementById('newMenuImage').value = '';
      alert('Menu disimpan (GLOBAL)');
      goMenu();
    })
    .catch(err => {
      console.error(err);
      alert('Gagal menyimpan menu');
    });
}

/* =========================
   Keranjang (cart)
   ========================= */
function order(n, h){
  cart.push({ nama: n, harga: h });
  alert(n + ' ditambahkan ke keranjang');
}

function renderCart(){
  cartContainer.innerHTML = '';
  if(cart.length === 0){
    cartContainer.innerHTML = '<p>Keranjang kosong</p>';
    return;
  }

  let total = 0;
  cart.forEach((it, idx) => {
    total += it.harga;
    const wrap = document.createElement('div');
    wrap.className = 'menu-item';

    const h5 = document.createElement('h5');
    h5.textContent = it.nama;

    const p = document.createElement('p');
    p.textContent = `Rp${Number(it.harga).toLocaleString('id-ID')}`;

    const del = document.createElement('button');
    del.className = 'btn btn-danger w-100';
    del.type = 'button';
    del.textContent = 'Hapus';
    del.addEventListener('click', () => {
      removeCart(idx);
    });

    wrap.appendChild(h5);
    wrap.appendChild(p);
    wrap.appendChild(del);

    cartContainer.appendChild(wrap);
  });

  const totalEl = document.createElement('h4');
  totalEl.className = 'mt-3';
  totalEl.textContent = `Total: Rp${Number(total).toLocaleString('id-ID')}`;
  cartContainer.appendChild(totalEl);
}

function removeCart(i){
  cart.splice(i,1);
  renderCart();
}

function checkout(){
  if(cart.length === 0){ alert('Keranjang kosong'); return; }

  let pesan = 'Pesanan:%0A';
  let total = 0;
  cart.forEach(it => {
    pesan += `- ${it.nama} Rp${it.harga}%0A`;
    total += it.harga;
  });
  pesan += `%0ATotal: Rp${total}`;

<a href="https://wa.me/+62895343287264" target="_blank">
  Pesan via WhatsApp
</a>


/* =========================
   Auto-login check saat load
   ========================= */
if(localStorage.getItem('login')) goBeranda(); else showLogin();

/* =========================
   Notes / debugging helpers (opsional)
   ========================= */
// window._debug = { allMenus, cart, renderMenu, renderCart };
</script>

</body>
</html>
